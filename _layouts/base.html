---
common-css:
  - "/assets/css/bootstrap-social.css"
  - "/assets/css/beautifuljekyll.css"
common-ext-css:
  - href: "https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    sri: "sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
  - "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  - "https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"
  - "https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
common-ext-js:
  - href: "https://code.jquery.com/jquery-3.5.1.slim.min.js"
    sri: "sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
  - href: "https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    sri: "sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
  - href: "https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    sri: "sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
common-js:
  - "/assets/js/beautifuljekyll.js"
---

<!DOCTYPE html>
<html lang="{{ page.language | default: site.language | default: 'en' }}">
  {% include head.html %}

  <!-- Charger Auth0 SPA SDK avant tout autre script JS -->
  <!-- Charge le SDK sans defer, pour qu’il soit dispo immédiatement -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.21/auth0-spa-js.production.js"></script>

  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">

<body>
  {% include gtm_body.html %}

  {% include nav.html %}

  {{ content }}

  {% include footer.html %}
  {% include footer-scripts.html %}

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      if (typeof createAuth0Client !== 'function') {
        console.error('Auth0 SDK non trouvé : vérifie que le <script src="...auth0-spa-js..."> est bien chargé avant celui‑ci.');
        return;
      }
      const auth0 = await createAuth0Client({
        domain: 'dev-3u60nolrb8e0gznx.eu.auth0.com',
        client_id: 'LMUi6iOzbNDjg2uNFV9dWXYRNrCJkKOk',
        cacheLocation: 'localstorage',
        useRefreshTokens: true,
        redirect_uri: window.location.origin
      });

      // Traiter la redirection Auth0
      if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
        try {
          await auth0.handleRedirectCallback();
          window.history.replaceState({}, document.title, window.location.pathname);
        } catch (e) {
          console.error('Erreur lors du callback Auth0:', e);
        }
      }

      const btnLogin    = document.getElementById('btn-login');
      const btnLogout   = document.getElementById('btn-logout');
      const profileName = document.getElementById('profile-name');

      const updateUI = async () => {
        if (await auth0.isAuthenticated()) {
          btnLogin.classList.add('d-none');
          btnLogout.classList.remove('d-none');
          const user = await auth0.getUser();
          profileName.textContent = user.name || user.email;
        } else {
          btnLogin.classList.remove('d-none');
          btnLogout.classList.add('d-none');
          profileName.textContent = '';
        }
      };

      btnLogin.addEventListener('click', () => auth0.loginWithRedirect());
      btnLogout.addEventListener('click', () => auth0.logout({ returnTo: window.location.origin }));

      // Initial UI
      await updateUI();
    });
  </script>
</body>
</html>
